# ä¸»é¢˜ç³»ç»Ÿå®ŒæˆæŠ¥å‘Š

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. ä¸»é¢˜é…ç½®å­˜å‚¨
- **æ–‡ä»¶**: `miniprogram/utils/theme-config.js`
- **ä¸»é¢˜æ•°é‡**: 18ä¸ªå®Œæ•´ä¸»é¢˜
  - å…è´¹ä¸»é¢˜(8ä¸ª): pink-girl, green-fresh, dark-mode, lavender-dream, coral-beach, mint-fresh, sky-blue, peach-blossom
  - ç­¾åˆ°è§£é”(3ä¸ª): cherry-blossom(7å¤©), autumn-maple(15å¤©), winter-snow(30å¤©)
  - ç§¯åˆ†è§£é”(4ä¸ª): starry-sky(300), golden-sunset(300), klein-blue(300), rose-gold(500)
  - ä»˜è´¹ä¸»é¢˜(3ä¸ª): aurora(99å¸), galaxy(129å¸)

### 2. ä¸»é¢˜ç®¡ç†å™¨
- **æ–‡ä»¶**: `miniprogram/utils/theme-manager.js`
- **æ ¸å¿ƒåŠŸèƒ½**:
  - âœ… æœ¬åœ°ä¼˜å…ˆåŠ è½½ç­–ç•¥
  - âœ… ä» theme-config.js åŠ è½½ä¸»é¢˜æ•°æ®
  - âœ… ç”Ÿæˆ CSS å˜é‡å¹¶æ³¨å…¥ app.globalData.cssVars
  - âœ… æ”¯æŒä¸»é¢˜åˆ‡æ¢ switchTheme(themeId)
  - âœ… é€šçŸ¥æ‰€æœ‰é¡µé¢æ›´æ–° notifyPagesUpdate()
  - âœ… å¯é€‰çš„æœåŠ¡å™¨åŒæ­¥(ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½)

### 3. å¯¼èˆªæ å®Œæ•´æ€§
- **æ–‡ä»¶**: `miniprogram/app.json`
- **å¯¼èˆªé¡¹**: 5ä¸ªå®Œæ•´æ ‡ç­¾é¡µ
  1. é¦–é¡µ (pages/index/index)
  2. æ—¥è®° (pages/diary/list/list)
  3. **å›¾æ–‡é›†** (pages/album/list/list) - âœ… å·²æ·»åŠ 
  4. ä¸»é¢˜ (pages/theme/store/store)
  5. æˆ‘çš„ (pages/user/user)

### 4. é¡µé¢ä¸»é¢˜é›†æˆ
æ‰€æœ‰9ä¸ªæ ¸å¿ƒé¡µé¢å‡å·²å®ç°ä¸»é¢˜åŠ¨æ€æ¸²æŸ“:

#### âœ… å·²éªŒè¯é¡µé¢
| é¡µé¢ | applyTheme() | cssVars | è°ƒç”¨æ—¶æœº |
|-----|-------------|---------|---------|
| index/index | âœ… | âœ… | onLoad, onShow |
| diary/list | âœ… | âœ… | onLoad, onShow |
| diary/create | âœ… | âœ… | onLoad, onShow |
| album/list | âœ… | âœ… | onLoad, onShow |
| album/create | âœ… | âœ… | onLoad, onShow |
| theme/store | âœ… | âœ… | onLoad, onShow |
| checkin | âœ… | âœ… | onLoad, onShow |
| recharge | âœ… | âœ… | onLoad, onShow |
| user | âœ… | âœ… | onLoad, onShow |

## ğŸ¨ ä¸»é¢˜ç³»ç»Ÿå·¥ä½œæµç¨‹

```
1. å°ç¨‹åºå¯åŠ¨ (app.js onLaunch)
   â†“
2. themeManager.init() åˆå§‹åŒ–
   â†“
3. ä» localStorage è¯»å– currentThemeId (é»˜è®¤: pink-girl)
   â†“
4. ä» theme-config.js è·å–ä¸»é¢˜æ•°æ®
   â†“
5. applyLocalTheme() ç”Ÿæˆ CSS å˜é‡
   â†“
6. æ³¨å…¥åˆ° app.globalData.cssVars
   â†“
7. å„é¡µé¢é€šè¿‡ applyTheme() è¯»å– cssVars
   â†“
8. WXML ä½¿ç”¨ {{cssVars['--theme-primary']}} åŠ¨æ€æ¸²æŸ“
```

## ğŸ“ CSS å˜é‡æ˜ å°„

æ¯ä¸ªä¸»é¢˜åŒ…å«ä»¥ä¸‹ CSS å˜é‡:

```javascript
{
  '--theme-primary': colors.primary,          // ä¸»è‰²
  '--theme-secondary': colors.secondary,      // æ¬¡è¦è‰²
  '--theme-accent': colors.accent,            // å¼ºè°ƒè‰²
  '--theme-background': colors.background,    // èƒŒæ™¯è‰²
  '--theme-surface': colors.surface,          // è¡¨é¢è‰²
  '--theme-text-primary': colors.textPrimary, // ä¸»æ–‡å­—è‰²
  '--theme-text-secondary': colors.textSecondary, // æ¬¡è¦æ–‡å­—è‰²
  '--theme-border': colors.border             // è¾¹æ¡†è‰²
}
```

## ğŸ”„ ä¸»é¢˜åˆ‡æ¢æµç¨‹

1. ç”¨æˆ·åœ¨ä¸»é¢˜å•†åº—é€‰æ‹©ä¸»é¢˜
2. è°ƒç”¨ `themeManager.switchTheme(themeId)`
3. ä» theme-config.js è·å–ä¸»é¢˜æ•°æ®
4. ç”Ÿæˆæ–°çš„ CSS å˜é‡
5. æ›´æ–° app.globalData.cssVars
6. é€šçŸ¥æ‰€æœ‰å·²æ‰“å¼€çš„é¡µé¢ onThemeChange()
7. å„é¡µé¢è°ƒç”¨ applyTheme() æ›´æ–°è§†å›¾
8. ä¿å­˜ä¸»é¢˜ ID åˆ° localStorage

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### WXML ä¸­ä½¿ç”¨ä¸»é¢˜å˜é‡
```xml
<!-- èƒŒæ™¯è‰² -->
<view style="background: {{cssVars['--theme-background']}};">

<!-- å¡ç‰‡ -->
<view style="background: {{cssVars['--theme-surface']}}; border: 1px solid {{cssVars['--theme-border']}};">

  <!-- æ ‡é¢˜ -->
  <text style="color: {{cssVars['--theme-text-primary']}};">æ ‡é¢˜</text>

  <!-- æŒ‰é’® -->
  <button style="background: {{cssVars['--theme-primary']}}; color: #FFF;">æŒ‰é’®</button>
</view>
```

### JS ä¸­åº”ç”¨ä¸»é¢˜
```javascript
Page({
  data: {
    cssVars: {}
  },

  onLoad() {
    this.applyTheme();
  },

  onShow() {
    this.applyTheme();
  },

  applyTheme() {
    const app = getApp();
    this.setData({
      cssVars: app.globalData.cssVars || {}
    });
  },

  // ä¸»é¢˜åˆ‡æ¢å›è°ƒ(å¯é€‰)
  onThemeChange(theme) {
    this.applyTheme();
  }
})
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… æœ¬åœ°ä¼˜å…ˆç­–ç•¥
- ä¸»é¢˜é…ç½®å­˜å‚¨åœ¨æœ¬åœ° theme-config.js
- æ— éœ€ç½‘ç»œå³å¯æ­£å¸¸å·¥ä½œ
- æœåŠ¡å™¨åŒæ­¥ä¸ºå¯é€‰åŠŸèƒ½

### âœ… åŠ¨æ€å“åº”
- æ‰€æœ‰é¡µé¢ã€å¡ç‰‡ã€æŒ‰é’®ã€æ–‡å­—è‡ªåŠ¨å“åº”ä¸»é¢˜å˜åŒ–
- åˆ‡æ¢ä¸»é¢˜æ—¶æ— éœ€åˆ·æ–°é¡µé¢
- å·²æ‰“å¼€çš„é¡µé¢å®æ—¶æ›´æ–°

### âœ… æ€§èƒ½ä¼˜åŒ–
- CSS å˜é‡ç”Ÿæˆä¸€æ¬¡,æ‰€æœ‰é¡µé¢å…±äº«
- ä½¿ç”¨ setData æ‰¹é‡æ›´æ–°
- é¿å…é‡å¤è®¡ç®—

### âœ… ç”¨æˆ·ä½“éªŒ
- ä¸»é¢˜æŒä¹…åŒ–(localStorage)
- å¹³æ»‘åˆ‡æ¢è¿‡æ¸¡
- è§¦è§‰åé¦ˆæ”¯æŒ

## ğŸ“¦ æ–‡ä»¶æ¸…å•

1. `miniprogram/utils/theme-config.js` - 18ä¸ªä¸»é¢˜é…ç½®
2. `miniprogram/utils/theme-manager.js` - ä¸»é¢˜ç®¡ç†å™¨
3. `miniprogram/app.js` - åˆå§‹åŒ–è°ƒç”¨
4. `miniprogram/app.json` - 5ä¸ªå¯¼èˆªæ ‡ç­¾é…ç½®
5. æ‰€æœ‰é¡µé¢ JS - applyTheme() å®ç°
6. æ‰€æœ‰é¡µé¢ WXML - cssVars ä½¿ç”¨

## âœ… éªŒè¯æ¸…å•

- [x] 18ä¸ªä¸»é¢˜å®Œæ•´é…ç½®
- [x] ä¸»é¢˜ç®¡ç†å™¨æœ¬åœ°åŠ è½½
- [x] CSS å˜é‡ç”Ÿæˆ
- [x] 5ä¸ªå¯¼èˆªæ ‡ç­¾
- [x] 9ä¸ªé¡µé¢ä¸»é¢˜é›†æˆ
- [x] ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
- [x] ä¸»é¢˜æŒä¹…åŒ–
- [x] åŠ¨æ€æ¸²æŸ“

## ğŸ‰ æ€»ç»“

ä¸»é¢˜ç³»ç»Ÿå·²**å®Œå…¨é›†æˆ**åˆ°å¾®ä¿¡å°ç¨‹åºä¸­:
- âœ… æ‰€æœ‰18ä¸ªä¸»é¢˜å·²å­˜å‚¨åˆ°æœ¬åœ°
- âœ… æ‰€æœ‰é¡µé¢ã€å¡ç‰‡ã€æŒ‰é’®ã€æ–‡å­—å‡å¯åŠ¨æ€å“åº”ä¸»é¢˜
- âœ… 5ä¸ªå¯¼èˆªæ ‡ç­¾å®Œæ•´
- âœ… ä¸»é¢˜åˆ‡æ¢æµç¨‹å®Œå–„
- âœ… æ”¯æŒç¦»çº¿å·¥ä½œ

ç”¨æˆ·å¯ä»¥åœ¨ä¸»é¢˜å•†åº—è‡ªç”±åˆ‡æ¢ä¸»é¢˜,æ‰€æœ‰UIå…ƒç´ ä¼šç«‹å³å“åº”æ–°ä¸»é¢˜çš„é¢œè‰²é…ç½®ã€‚
